#!/bin/sh
set -e
# set -x

in_tree=`git rev-parse --is-inside-work-tree`;
if [ "$in_tree" = "true" ]; then
    gitdir=`git rev-parse --git-dir`
    if [ -d $gitdir ]; then
        branch_name=`git branch-name`
        logfile=$gitdir/info/.branch.log
        if [ -f $gitdir/refs/heads/$branch_name ]; then
            mkdir -p `dirname $logfile`
            echo $branch_name >> $logfile
            tail -n 100 $logfile | uniq > $logfile.tmp
            mv $logfile.tmp $logfile
        fi
    fi
fi
