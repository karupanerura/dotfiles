#!/bin/sh
set -e
# set -x

IN_TREE=`git rev-parse --is-inside-work-tree`;
if [ "$IN_TREE" = "true" ]; then
    GITROOT=`git rev-parse --show-toplevel`
    if [ -d $GITROOT ]; then
        LOGFILE=$GITROOT/.git/info/.branch.log
        test -d $GITROOT/.git/info || mkdir $GITROOT/.git/info
        if [ -f $LOGFILE ]; then
            git checkout `tail -n2 $LOGFILE | head -n1`
            head -n -2 $LOGFILE > $LOGFILE.tmp
            mv $LOGFILE.tmp $LOGFILE
        fi
    fi
fi
