#!/usr/bin/env zsh
set -e
set -u

function upgrade {
    cd $1
    echo "### upgrade $1 ..."
    git fetch -qp
    git pull -q
    if [ -d plugins ]; then
        echo "### upgrade plugins ..."
        for plugin in plugins/*; do
            upgrade $plugin &
        done
        wait
    fi
    cd -
}

upgrade $HOME/.anyenv
for dir in `anyenv envs`; do
    upgrade $HOME/.anyenv/envs/$dir &
done
wait
