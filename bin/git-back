#!/bin/sh
set -e
# set -x

in_tree=`git rev-parse --is-inside-work-tree`;
if [ "$in_tree" = "true" ]; then
    gitdir=`git rev-parse --git-dir`
    logfile=$gitdir/info/.branch.log
    test -d $gitdir/info || mkdir $gitdir/info
    if [ -f $logfile ]; then
        git checkout `tail -n2 $logfile | head -n1`
        head -n -2 $logfile > $logfile.tmp
        mv $logfile.tmp $logfile
    fi
fi
